# ğŸ–¥ï¸ æŸ¥ç ”é˜…è‰²è¡¨æƒ…è¯†åˆ«æœåŠ¡ç«¯

## ğŸ“‹ æœåŠ¡è¯´æ˜

æœ¬æœåŠ¡æä¾›åŸºäºæ·±åº¦å­¦ä¹ çš„äººè„¸è¡¨æƒ…è¯†åˆ«APIï¼Œæ”¯æŒ7ç§åŸºæœ¬è¡¨æƒ…çš„å‡†ç¡®è¯†åˆ«ã€‚

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
cd flask/serever
python start_server.py
```

å¯åŠ¨è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- âœ… æ£€æŸ¥ç«¯å£å¯ç”¨æ€§
- âœ… éªŒè¯æ¨¡å‹æ–‡ä»¶
- âœ… æ˜¾ç¤ºç½‘ç»œé…ç½®ä¿¡æ¯
- âœ… æä¾›è¯¦ç»†çš„å¯åŠ¨æ—¥å¿—

### æ–¹æ³•äºŒï¼šç›´æ¥è¿è¡Œ

```bash
cd flask/serever
python app.py
```

## ğŸ”§ é…ç½®è¯´æ˜

### æœåŠ¡å™¨é…ç½®

æœåŠ¡å™¨å·²é…ç½®ä¸ºå›ºå®šIPåœ°å€ï¼Œä¾¿äºå°ç¨‹åºè°ƒç”¨ï¼š

- **IPåœ°å€**: `192.168.1.3`
- **ç«¯å£**: `5000`
- **åè®®**: `HTTP`

### å°ç¨‹åºé…ç½®

ç¡®ä¿å°ç¨‹åºä¸­çš„æœåŠ¡å™¨é…ç½®æ­£ç¡®ï¼š

```javascript
// pages/index/index.js
const SERVER_CONFIG = {
  baseUrl: 'http://192.168.1.3:5000',  // âœ… å·²é…ç½®å›ºå®šIP
  endpoints: {
    inference: '/inference'
  },
  timeout: 30000
}
```

## ğŸ“¡ APIæ¥å£

### 1. è¡¨æƒ…è¯†åˆ«

**URL**: `POST /inference`

**è¯·æ±‚ç¤ºä¾‹**:
```json
{
  "image": "data:image/jpeg;base64,..."
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "faces": [
    {
      "box": [x1, y1, x2, y2],
      "expression": "Happy",
      "confidence": 0.95
    }
  ],
  "total_faces": 1,
  "processing_time": 0.35,
  "timestamp": "2024-12-19T..."
}
```

### 2. å¥åº·æ£€æŸ¥

**URL**: `GET /health`

**å“åº”ç¤ºä¾‹**:
```json
{
  "status": "healthy",
  "service": "FaceEmotion API",
  "version": "1.0.0",
  "timestamp": "2024-12-19T..."
}
```

## ğŸ—‚ï¸ æ–‡ä»¶ç»“æ„

```
flask/serever/
â”œâ”€â”€ app.py              # Flaskä¸»åº”ç”¨
â”œâ”€â”€ start_server.py     # å¯åŠ¨è„šæœ¬ï¼ˆæ¨èä½¿ç”¨ï¼‰
â”œâ”€â”€ Config.py           # é…ç½®æ–‡ä»¶
â”œâ”€â”€ config.ini         # æœåŠ¡å™¨é…ç½®
â”œâ”€â”€ detect_tools.py    # æ£€æµ‹å·¥å…·
â”œâ”€â”€ requirements.txt   # ä¾èµ–åŒ…
â”œâ”€â”€ model/            # AIæ¨¡å‹ç›®å½•
â”‚   â”œâ”€â”€ yolov8n-face.pt
â”‚   â””â”€â”€ expression_cls.pt
â””â”€â”€ Font/             # å­—ä½“æ–‡ä»¶
    â””â”€â”€ platech.ttf
```

## ğŸ”§ æ•…éšœæ’é™¤

### 1. ç«¯å£å ç”¨
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -ano | findstr :5000

# Windowsæ€æ­»è¿›ç¨‹
taskkill /PID <è¿›ç¨‹ID> /F

# Linux/Macæ€æ­»è¿›ç¨‹
kill -9 <è¿›ç¨‹ID>
```

### 2. æ¨¡å‹æ–‡ä»¶ç¼ºå¤±
```bash
# ç¡®ä¿ä»¥ä¸‹æ–‡ä»¶å­˜åœ¨
model/yolov8n-face.pt      # äººè„¸æ£€æµ‹æ¨¡å‹
model/expression_cls.pt    # è¡¨æƒ…åˆ†ç±»æ¨¡å‹
```

### 3. IPåœ°å€é…ç½®
```python
# å¦‚éœ€ä¿®æ”¹IPåœ°å€ï¼Œç¼–è¾‘ app.py
SERVER_HOST = 'ä½ çš„IPåœ°å€'  # ä¿®æ”¹ä¸ºå®é™…IP
```

### 4. ä¾èµ–å®‰è£…é—®é¢˜
```bash
# å‡çº§pip
python -m pip install --upgrade pip

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å¦‚æœå®‰è£…å¤±è´¥ï¼Œå°è¯•æ¸…åæº
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/
```

## ğŸ“Š æ€§èƒ½ç›‘æ§

### æœåŠ¡çŠ¶æ€æ£€æŸ¥
```bash
# æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ
curl http://192.168.1.3:5000/health

# æµ‹è¯•è¡¨æƒ…è¯†åˆ«API
curl -X POST http://192.168.1.3:5000/inference \
  -H "Content-Type: application/json" \
  -d '{"image":"data:image/jpeg;base64,..."}'
```

### æ—¥å¿—ç›‘æ§

æœåŠ¡å¯åŠ¨åä¼šåœ¨æ§åˆ¶å°æ˜¾ç¤ºè¯¦ç»†æ—¥å¿—ï¼š
- è¯·æ±‚å¤„ç†æ—¥å¿—
- é”™è¯¯ä¿¡æ¯
- æ€§èƒ½ç»Ÿè®¡

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

1. **ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²**
   - ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨Flaskå†…ç½®æœåŠ¡å™¨
   - æ¨èä½¿ç”¨Gunicorn + Nginx

2. **ç½‘ç»œå®‰å…¨**
   - é…ç½®é˜²ç«å¢™è§„åˆ™
   - ä½¿ç”¨HTTPSåè®®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

3. **æ–‡ä»¶æƒé™**
   - ç¡®ä¿æ¨¡å‹æ–‡ä»¶åªè¯»æƒé™
   - é™åˆ¶ä¸Šä¼ æ–‡ä»¶å¤§å°

## ğŸ†˜ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. âœ… Pythonç‰ˆæœ¬ (3.8+)
2. âœ… ä¾èµ–åŒ…å®‰è£…å®Œæ•´
3. âœ… æ¨¡å‹æ–‡ä»¶å­˜åœ¨
4. âœ… ç«¯å£æœªè¢«å ç”¨
5. âœ… ç½‘ç»œè¿æ¥æ­£å¸¸

---

*æœ€åæ›´æ–°ï¼š2024-12-19*
